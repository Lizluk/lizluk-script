--[[
    Fe Emote - Persistent Animation (No Interrupt)
    Based on: lizluk-script Emote Fe
    
    T√≠nh nƒÉng:
    - Animation emote lu√¥n ch·∫°y d√π nh·∫£y, ch·∫°y, va ch·∫°m
    - Ghi ƒë√® Humanoid State ƒë·ªÉ kh√¥ng d·ª´ng anim
    - T·ª± ƒë·ªông restart n·∫øu b·ªã stop
    - N√∫t T·∫°m d·ª´ng / Ti·∫øp t·ª•c animation
    - C√≥ GUI ƒë·ªÉ ch·ªçn emote
--]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")
local Animator = Humanoid:WaitForChild("Animator")
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")

-- =============================================
-- LOAD SCRIPT G·ªêC (Lizluk Emote Fe)
-- =============================================
local success, err = pcall(function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/Lizluk/lizluk-script/refs/heads/main/Emote%20Fe"))()
end)
if not success then
    warn("[Fe Emote] Kh√¥ng load ƒë∆∞·ª£c script g·ªëc: " .. tostring(err))
end

-- =============================================
-- C·∫§U H√åNH
-- =============================================
local Config = {
    -- Delay gi·ªØa m·ªói l·∫ßn check (gi√¢y)
    CheckInterval = 0.05,
    
    -- Animation ID c·ªßa emote b·∫°n mu·ªën gi·ªØ (thay b·∫±ng ID th·ª±c t·∫ø)
    -- ƒê·ªÉ tr·ªëng n·∫øu mu·ªën t·ª± ƒë·ªông detect animation ƒëang ch·∫°y
    TargetAnimationId = "",
    
    -- T·ªëc ƒë·ªô animation (1 = b√¨nh th∆∞·ªùng)
    AnimationSpeed = 1,
    
    -- C√≥ ghi ƒë√® Jump state kh√¥ng
    OverrideJump = true,
    
    -- C√≥ ghi ƒë√® Fall state kh√¥ng
    OverrideFall = true,
}

-- =============================================
-- PERSISTENT ANIMATION CORE
-- =============================================

local currentLockedTrack = nil
local isLocked = false
local isPaused = false

-- L∆∞u l·∫°i track animation ƒëang ch·∫°y t·ª´ emote
local function GetCurrentEmoteTrack()
    if not Animator then return nil end
    
    -- L·∫•y t·∫•t c·∫£ track ƒëang play
    local playingTracks = Animator:GetPlayingAnimationTracks()
    
    -- ∆Øu ti√™n track theo ID c·∫•u h√¨nh
    if Config.TargetAnimationId ~= "" then
        for _, track in pairs(playingTracks) do
            if track.Animation and tostring(track.Animation.AnimationId):find(Config.TargetAnimationId) then
                return track
            end
        end
    end
    
    -- N·∫øu kh√¥ng c√≥ ID c·ª• th·ªÉ, l·∫•y track d√†i nh·∫•t (th∆∞·ªùng l√† emote)
    -- B·ªè qua c√°c track m·∫∑c ƒë·ªãnh c·ªßa Roblox
    local defaultAnims = {
        "507766388",  -- idle
        "507766666",  -- walk
        "507766951",  -- run
        "507776061",  -- jump
        "507776159",  -- fall
        "507777826",  -- climb
        "507777347",  -- swim
    }
    
    for _, track in pairs(playingTracks) do
        if track.Animation then
            local animId = tostring(track.Animation.AnimationId)
            local isDefault = false
            for _, defaultId in pairs(defaultAnims) do
                if animId:find(defaultId) then
                    isDefault = true
                    break
                end
            end
            if not isDefault then
                return track
            end
        end
    end
    
    return nil
end

-- H√†m kh√≥a animation hi·ªán t·∫°i
local function LockAnimation(track)
    if not track then return end
    
    currentLockedTrack = track
    isLocked = true
    
    -- ƒê·∫£m b·∫£o priority cao nh·∫•t
    track.Priority = Enum.AnimationPriority.Action4
    
    -- N·∫øu ƒë√£ stop th√¨ play l·∫°i
    if not track.IsPlaying then
        track:Play(0, 1, Config.AnimationSpeed)
    end
    
    -- ƒê·∫£m b·∫£o kh√¥ng b·ªã stop b·ªüi Humanoid
    track:AdjustSpeed(Config.AnimationSpeed)
    track:AdjustWeight(1)
end

-- Override Humanoid State ƒë·ªÉ animation kh√¥ng b·ªã gi√°n ƒëo·∫°n
local function OverrideHumanoidState()
    -- Disable default animation script
    local animScript = Character:FindFirstChild("Animate")
    if animScript then
        -- Kh√¥ng x√≥a, ch·ªâ d·ª´ng c√°c track m·∫∑c ƒë·ªãnh khi emote ƒëang lock
    end
    
    -- K·∫øt n·ªëi StateChanged
    Humanoid.StateChanged:Connect(function(oldState, newState)
        if not isLocked or not currentLockedTrack then return end
        
        -- Khi nh·∫£y ho·∫∑c ng√£, gi·ªØ animation emote
        if Config.OverrideJump and (newState == Enum.HumanoidStateType.Jumping or newState == Enum.HumanoidStateType.Freefall) then
            task.defer(function()
                if currentLockedTrack and not currentLockedTrack.IsPlaying then
                    currentLockedTrack:Play(0, 1, Config.AnimationSpeed)
                end
                if currentLockedTrack then
                    currentLockedTrack.Priority = Enum.AnimationPriority.Action4
                    currentLockedTrack:AdjustWeight(1)
                end
            end)
        end
    end)
end

-- Loop ch√≠nh: li√™n t·ª•c gi·ªØ animation
local persistConnection
local function StartPersistLoop()
    if persistConnection then
        persistConnection:Disconnect()
    end
    
    persistConnection = RunService.Heartbeat:Connect(function()
        if not isLocked then return end
        if not currentLockedTrack then return end
        
        -- N·∫øu ƒëang t·∫°m d·ª´ng: gi·ªØ animation ·ªü frame cu·ªëi (speed = 0)
        if isPaused then
            if currentLockedTrack.IsPlaying then
                pcall(function()
                    currentLockedTrack:AdjustSpeed(0)
                end)
            end
            return
        end
        
        -- N·∫øu track b·ªã stop, play l·∫°i
        if not currentLockedTrack.IsPlaying then
            pcall(function()
                currentLockedTrack:Play(0, 1, Config.AnimationSpeed)
                currentLockedTrack.Priority = Enum.AnimationPriority.Action4
            end)
        end
        
        -- ƒê·∫£m b·∫£o speed ƒë√∫ng (ph√≤ng tr∆∞·ªùng h·ª£p v·ª´a resume)
        pcall(function()
            currentLockedTrack:AdjustSpeed(Config.AnimationSpeed)
        end)
        
        -- D·ª´ng c√°c animation state m·∫∑c ƒë·ªãnh (jump, fall) n·∫øu emote ƒëang lock
        local playingTracks = Animator:GetPlayingAnimationTracks()
        for _, track in pairs(playingTracks) do
            if track ~= currentLockedTrack and track.Animation then
                local animId = tostring(track.Animation.AnimationId)
                -- D·ª´ng jump v√† fall animation
                if animId:find("507776061") or animId:find("507776159") or animId:find("507766388") then
                    pcall(function()
                        track:Stop(0)
                    end)
                end
            end
        end
    end)
end

-- =============================================
-- GUI
-- =============================================

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "PersistEmoteGui"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = LocalPlayer.PlayerGui

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 200, 0, 120)
MainFrame.Position = UDim2.new(0.5, -100, 1, -135)
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
MainFrame.BackgroundTransparency = 0.1
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 10)
UICorner.Parent = MainFrame

-- Ti√™u ƒë·ªÅ
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 25)
Title.Position = UDim2.new(0, 0, 0, 0)
Title.BackgroundColor3 = Color3.fromRGB(80, 40, 120)
Title.BackgroundTransparency = 0
Title.Text = "üé≠ Fe Emote Lock"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextScaled = true
Title.Font = Enum.Font.GothamBold
Title.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 10)
TitleCorner.Parent = Title

-- Status Label
local StatusLabel = Instance.new("TextLabel")
StatusLabel.Size = UDim2.new(1, -10, 0, 20)
StatusLabel.Position = UDim2.new(0, 5, 0, 28)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = "Tr·∫°ng th√°i: Ch∆∞a lock"
StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
StatusLabel.TextScaled = true
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.Parent = MainFrame

-- N√∫t Lock/Unlock
local LockButton = Instance.new("TextButton")
LockButton.Size = UDim2.new(0, 85, 0, 28)
LockButton.Position = UDim2.new(0, 5, 0, 55)
LockButton.BackgroundColor3 = Color3.fromRGB(50, 180, 80)
LockButton.Text = "üîí Lock Emote"
LockButton.TextColor3 = Color3.fromRGB(255, 255, 255)
LockButton.TextScaled = true
LockButton.Font = Enum.Font.GothamBold
LockButton.Parent = MainFrame

local LockCorner = Instance.new("UICorner")
LockCorner.CornerRadius = UDim.new(0, 6)
LockCorner.Parent = LockButton

-- N√∫t Stop
local StopButton = Instance.new("TextButton")
StopButton.Size = UDim2.new(0, 85, 0, 28)
StopButton.Position = UDim2.new(0, 105, 0, 55)
StopButton.BackgroundColor3 = Color3.fromRGB(180, 50, 50)
StopButton.Text = "üîì Unlock"
StopButton.TextColor3 = Color3.fromRGB(255, 255, 255)
StopButton.TextScaled = true
StopButton.Font = Enum.Font.GothamBold
StopButton.Parent = MainFrame

local StopCorner = Instance.new("UICorner")
StopCorner.CornerRadius = UDim.new(0, 6)
StopCorner.Parent = StopButton

-- N√∫t T·∫°m d·ª´ng / Ti·∫øp t·ª•c (h√†ng 2, gi·ªØa)
local PauseButton = Instance.new("TextButton")
PauseButton.Size = UDim2.new(0, 130, 0, 28)
PauseButton.Position = UDim2.new(0, 35, 0, 88)
PauseButton.BackgroundColor3 = Color3.fromRGB(200, 140, 20)
PauseButton.Text = "‚è∏ T·∫°m d·ª´ng"
PauseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
PauseButton.TextScaled = true
PauseButton.Font = Enum.Font.GothamBold
PauseButton.Parent = MainFrame

local PauseCorner = Instance.new("UICorner")
PauseCorner.CornerRadius = UDim.new(0, 6)
PauseCorner.Parent = PauseButton

-- K√©o GUI
local dragging = false
local dragStart, startPos

MainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(
            startPos.X.Scale, startPos.X.Offset + delta.X,
            startPos.Y.Scale, startPos.Y.Offset + delta.Y
        )
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
    end
end)

-- =============================================
-- S·ª∞ KI·ªÜN N√öT
-- =============================================

LockButton.MouseButton1Click:Connect(function()
    -- T√¨m emote track ƒëang ch·∫°y
    local track = GetCurrentEmoteTrack()
    
    if track then
        LockAnimation(track)
        StartPersistLoop()
        StatusLabel.Text = "‚úÖ ƒêang lock: " .. tostring(track.Animation.AnimationId):match("%d+") or "?"
        StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        LockButton.BackgroundColor3 = Color3.fromRGB(30, 120, 50)
    else
        StatusLabel.Text = "‚ö†Ô∏è B·∫≠t emote tr∆∞·ªõc!"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 200, 50)
    end
end)

StopButton.MouseButton1Click:Connect(function()
    isLocked = false
    isPaused = false
    currentLockedTrack = nil
    
    if persistConnection then
        persistConnection:Disconnect()
        persistConnection = nil
    end
    
    PauseButton.Text = "‚è∏ T·∫°m d·ª´ng"
    PauseButton.BackgroundColor3 = Color3.fromRGB(200, 140, 20)
    StatusLabel.Text = "Tr·∫°ng th√°i: ƒê√£ unlock"
    StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    LockButton.BackgroundColor3 = Color3.fromRGB(50, 180, 80)
end)

PauseButton.MouseButton1Click:Connect(function()
    if not isLocked or not currentLockedTrack then
        StatusLabel.Text = "‚ö†Ô∏è Lock emote tr∆∞·ªõc!"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 200, 50)
        return
    end
    
    if not isPaused then
        -- T·∫°m d·ª´ng: ƒë·∫∑t speed = 0, animation ƒë·ª©ng y√™n ·ªü frame hi·ªán t·∫°i
        isPaused = true
        pcall(function()
            currentLockedTrack:AdjustSpeed(0)
        end)
        PauseButton.Text = "‚ñ∂ Ti·∫øp t·ª•c"
        PauseButton.BackgroundColor3 = Color3.fromRGB(50, 130, 200)
        StatusLabel.Text = "‚è∏ ƒêang t·∫°m d·ª´ng"
        StatusLabel.TextColor3 = Color3.fromRGB(100, 180, 255)
    else
        -- Ti·∫øp t·ª•c: tr·∫£ l·∫°i speed b√¨nh th∆∞·ªùng
        isPaused = false
        pcall(function()
            currentLockedTrack:AdjustSpeed(Config.AnimationSpeed)
        end)
        PauseButton.Text = "‚è∏ T·∫°m d·ª´ng"
        PauseButton.BackgroundColor3 = Color3.fromRGB(200, 140, 20)
        StatusLabel.Text = "‚úÖ ƒêang lock & ch·∫°y"
        StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
    end
end)

-- =============================================
-- KH·ªûI ƒê·ªòNG
-- =============================================

OverrideHumanoidState()

-- X·ª≠ l√Ω khi nh√¢n v·∫≠t respawn
LocalPlayer.CharacterAdded:Connect(function(newChar)
    Character = newChar
    Humanoid = newChar:WaitForChild("Humanoid")
    Animator = Humanoid:WaitForChild("Animator")
    HumanoidRootPart = newChar:WaitForChild("HumanoidRootPart")
    
    isLocked = false
    isPaused = false
    currentLockedTrack = nil
    if persistConnection then persistConnection:Disconnect() end
    
    PauseButton.Text = "‚è∏ T·∫°m d·ª´ng"
    PauseButton.BackgroundColor3 = Color3.fromRGB(200, 140, 20)
    StatusLabel.Text = "Tr·∫°ng th√°i: Respawn - B·∫≠t l·∫°i emote"
    StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    
    task.wait(1)
    OverrideHumanoidState()
end)

print("[Fe Emote Lock] Script ƒë√£ kh·ªüi ƒë·ªông!")
print("[Fe Emote Lock] C√°ch d√πng: B·∫≠t emote tr∆∞·ªõc, r·ªìi nh·∫•n üîí Lock Emote")
