--// LIZLUK GHOST GUI ü¶ã SOLARA EDITION + TOKEN AUTH
-- Optimized for Solara executor with authentication

repeat task.wait() until game:IsLoaded()
task.wait(3)

print("üöÄ LIZLUK Loading...")

---------------- SERVICES ----------------
local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer

---------------- üîê TOKEN + USER AUTHENTICATION ----------------
local REQUIRED_TOKEN = "lizluk-ghost-2026"
local ALLOWED_USERID = 8076792445 -- <<< ƒê·ªîI USERID C·ª¶A B·∫†N

-- Check token
if not _G.LIZLUK_TOKEN or _G.LIZLUK_TOKEN ~= REQUIRED_TOKEN then
    player:Kick("‚õî Invalid Token! Use: _G.LIZLUK_TOKEN = 'lizluk-ghost-2026'")
    return
end

-- Check user
if player.UserId ~= ALLOWED_USERID then 
    player:Kick("‚õî User not authorized | UserID: " .. player.UserId)
    return 
end

print("‚úÖ Token valid")
print("‚úÖ User authorized:", player.Name)

---------------- SOLARA-SAFE CLAMP ----------------
local function safeClamp(val, min, max)
    if val < min then return min end
    if val > max then return max end
    return val
end

---------------- CONFIG ----------------
_G.LIZLUK_CONFIG = {
    Core = {
        MaxHealth = 5000,
        Health = 5000,
        MaxStamina = 10000,
        Stamina = 10000,
        BaseDamage = 1,
        AttackSpeed = 1.5
    },
    AttributesGui = {
        Dexterity = 20,
        Regeneration = 20,
        Stamina = 10000,
        Strength = 500,
        Stride = 20,
        StrikeGuard = 20,
        Vitality = 5000
    },
    StatisticsGui = {
        Enabled = true,
        TotalBossDamageGiven = 585308,
        TotalDamageGiven = 1457890
    },
    Stealth = {
        Enabled = true,
        FakeMaxHealth = 320,
        FakeMaxStamina = 290
    }
}
local DATA = _G.LIZLUK_CONFIG

---------------- üõ°Ô∏è STEALTH (SOLARA-COMPATIBLE) ----------------
_G.FAKE_STATS = {
    MaxHealth = DATA.Stealth.FakeMaxHealth,
    Health = DATA.Stealth.FakeMaxHealth,
    MaxStamina = DATA.Stealth.FakeMaxStamina,
    Stamina = DATA.Stealth.FakeMaxStamina,
    AutoFake = true
}

-- Check Solara support
local hasMT = pcall(function() return getrawmetatable(game) end)
local hasNC = pcall(function() return newcclosure end)
local hasCC = pcall(function() return checkcaller end)

print("üîç Solara features:")
print("- Metatable:", hasMT and "‚úÖ" or "‚ùå")
print("- newcclosure:", hasNC and "‚úÖ" or "‚ùå")
print("- checkcaller:", hasCC and "‚úÖ" or "‚ùå")

-- Lightweight stealth with extended stamina support
if hasMT and hasNC and hasCC then
    local success = pcall(function()
        local mt = getrawmetatable(game)
        local oldIndex = mt.__index
        
        if setreadonly then
            setreadonly(mt, false)
        elseif make_writeable then
            make_writeable(mt)
        end
        
        mt.__index = newcclosure(function(self, key)
            if not checkcaller() then
                local success, isPlayerChar = pcall(function()
                    return self == player.Character or self.Parent == player.Character
                end)
                
                -- Hook character stats
                if success and isPlayerChar then
                    if key == "Health" then return _G.FAKE_STATS.Health end
                    if key == "MaxHealth" then return _G.FAKE_STATS.MaxHealth end
                    if key == "Stamina" then return _G.FAKE_STATS.Stamina end
                    if key == "MaxStamina" then return _G.FAKE_STATS.MaxStamina end
                end
                
                -- Hook NumberValue/IntValue for stamina
                local checkStamina = pcall(function()
                    if self.Parent == player.Character and (self:IsA("NumberValue") or self:IsA("IntValue")) then
                        if self.Name == "Stamina" and key == "Value" then
                            return true
                        elseif self.Name == "MaxStamina" and key == "Value" then
                            return true
                        end
                    end
                end)
                
                if checkStamina then
                    if self.Name == "Stamina" and key == "Value" then
                        return _G.FAKE_STATS.Stamina
                    elseif self.Name == "MaxStamina" and key == "Value" then
                        return _G.FAKE_STATS.MaxStamina
                    end
                end
            end
            
            return oldIndex(self, key)
        end)
        
        if setreadonly then
            setreadonly(mt, true)
        elseif make_readonly then
            make_readonly(mt)
        end
        
        print("‚úÖ Anti-detection active (Health + Stamina)")
    end)
    
    if not success then
        warn("‚ö†Ô∏è Stealth limited")
    end
else
    warn("‚ö†Ô∏è Basic mode")
end

-- Auto-sync fake stats based on real stats percentage
task.spawn(function()
    while task.wait(0.1) do
        if not _G.FAKE_STATS.AutoFake then continue end
        
        pcall(function()
            local char = player.Character
            if not char then return end
            
            -- Sync Health (from Humanoid)
            local hum = char:FindFirstChildOfClass("Humanoid")
            if hum and hum.MaxHealth > 0 then
                local realMaxHP = hum.MaxHealth
                local realHP = hum.Health
                local percentHP = realHP / realMaxHP
                _G.FAKE_STATS.Health = math.floor(_G.FAKE_STATS.MaxHealth * percentHP)
            end
            
            -- Sync Stamina (from Character Attributes or NumberValue)
            local realMaxStam = char:GetAttribute("MaxStamina")
            local realStam = char:GetAttribute("Stamina")
            
            -- Fallback: search for NumberValue/IntValue
            if not realMaxStam or not realStam then
                for _, obj in ipairs(char:GetDescendants()) do
                    if obj:IsA("NumberValue") or obj:IsA("IntValue") then
                        if obj.Name == "MaxStamina" then
                            realMaxStam = obj.Value
                        elseif obj.Name == "Stamina" then
                            realStam = obj.Value
                        end
                    end
                end
            end
            
            -- Calculate fake stamina based on percentage
            if realMaxStam and realStam and realMaxStam > 0 then
                local percentStam = realStam / realMaxStam
                _G.FAKE_STATS.Stamina = math.floor(_G.FAKE_STATS.MaxStamina * percentStam)
            end
        end)
    end
end)

-- Visual spoof for health and stamina displays
task.spawn(function()
    while task.wait(0.2) do
        if not _G.FAKE_STATS.AutoFake then continue end
        
        pcall(function()
            local char = player.Character
            if not char or not char:FindFirstChild("Head") then return end
            
            -- Fake health text on head
            for _, obj in ipairs(char.Head:GetDescendants()) do
                if obj:IsA("TextLabel") then
                    -- Health display (format: "123 / 456")
                    if string.find(obj.Text, "/") and (string.find(obj.Text, tostring(math.floor(_G.FAKE_STATS.Health))) or string.match(obj.Text, "%d+%s*/")) then
                        obj.Text = _G.FAKE_STATS.Health .. " / " .. _G.FAKE_STATS.MaxHealth
                    end
                end
            end
            
            -- Fake stamina display in PlayerGui
            local gui = player:FindFirstChild("PlayerGui")
            if gui then
                for _, obj in ipairs(gui:GetDescendants()) do
                    if obj:IsA("TextLabel") then
                        -- Stamina display
                        if string.find(string.lower(obj.Name), "stamina") or 
                           (string.find(obj.Text, "/") and string.find(string.lower(obj.Parent.Name or ""), "stamina")) then
                            obj.Text = _G.FAKE_STATS.Stamina .. " / " .. _G.FAKE_STATS.MaxStamina
                        end
                    end
                end
            end
        end)
    end
end)

---------------- APPLY CORE ----------------
-- Debug monitor for real stats
task.spawn(function()
    while task.wait(2) do
        pcall(function()
            local char = player.Character
            if not char then return end
            
            local hum = char:FindFirstChildOfClass("Humanoid")
            local realMaxStam = char:GetAttribute("MaxStamina")
            local realStam = char:GetAttribute("Stamina")
            
            -- Fallback search
            if not realMaxStam or not realStam then
                for _, obj in ipairs(char:GetDescendants()) do
                    if obj:IsA("NumberValue") or obj:IsA("IntValue") then
                        if obj.Name == "MaxStamina" then realMaxStam = obj.Value end
                        if obj.Name == "Stamina" then realStam = obj.Value end
                    end
                end
            end
            
            print("üìä REAL Stats - HP:", hum and math.floor(hum.Health) or "?", "/", hum and math.floor(hum.MaxHealth) or "?", 
                  "| Stam:", realStam and math.floor(realStam) or "?", "/", realMaxStam and math.floor(realMaxStam) or "?")
            print("üé≠ FAKE Stats - HP:", _G.FAKE_STATS.Health, "/", _G.FAKE_STATS.MaxHealth,
                  "| Stam:", _G.FAKE_STATS.Stamina, "/", _G.FAKE_STATS.MaxStamina)
        end)
    end
end)

local function applyCore(char)
    if not char then return end
    
    print("üîß Applying core...")
    
    task.spawn(function()
        for k,v in pairs(DATA.Core) do
            pcall(function() 
                char:SetAttribute(k, v)
            end)
        end
        
        for _, d in ipairs(char:GetDescendants()) do
            if (d:IsA("NumberValue") or d:IsA("IntValue")) and DATA.Core[d.Name] then
                pcall(function()
                    d.Value = DATA.Core[d.Name]
                end)
            end
        end
        
        local hum = char:FindFirstChildOfClass("Humanoid")
        if hum then
            hum.MaxHealth = DATA.Core.MaxHealth
            hum.Health = safeClamp(DATA.Core.Health, 0, DATA.Core.MaxHealth)
            print("‚úÖ Core applied - HP:", hum.Health, "/", hum.MaxHealth)
        end
    end)
end

---------------- APPLY ATTRIBUTES ----------------
local function applyAttributes()
    task.spawn(function()
        local success = pcall(function()
            local gui = player:WaitForChild("PlayerGui", 3)
            if not gui then return end
            
            local attr = gui:FindFirstChild("Gui", true)
            if attr then
                attr = attr:FindFirstChild("PlayerFolder", true)
                if attr then
                    attr = attr:FindFirstChild("AccountStats", true)
                    if attr then
                        attr = attr:FindFirstChild("Attributes", true)
                    end
                end
            end
            
            if not attr then
                for _, child in ipairs(gui:GetDescendants()) do
                    if child.Name == "Attributes" then
                        attr = child
                        break
                    end
                end
            end
            
            if not attr then
                warn("‚ùå Attributes GUI not found")
                return
            end
            
            local count = 0
            for k,v in pairs(DATA.AttributesGui) do
                local obj = attr:FindFirstChild(k)
                if obj and (obj:IsA("NumberValue") or obj:IsA("IntValue")) then
                    pcall(function()
                        obj.Value = v
                        count = count + 1
                    end)
                end
            end
            
            print("‚úÖ Applied", count, "attributes")
        end)
        
        if not success then
            warn("‚ö†Ô∏è Attributes not applied")
        end
    end)
end

---------------- RESPAWN ----------------
player.CharacterAdded:Connect(function(char)
    task.wait(1.5)
    applyCore(char)
    task.wait(0.5)
    applyAttributes()
end)

if player.Character then
    applyCore(player.Character)
    task.wait(1)
    applyAttributes()
end

---------------- STAT LOOP ----------------
task.spawn(function()
    while task.wait(1.5) do
        if not DATA.StatisticsGui.Enabled then continue end
        
        pcall(function()
            local gui = player.PlayerGui:FindFirstChild("Gui", true)
            if not gui then return end
            
            local stats = gui:FindFirstChild("Statistics", true)
            if not stats then return end
            
            for k,v in pairs(DATA.StatisticsGui) do
                if k ~= "Enabled" then
                    local obj = stats:FindFirstChild(k)
                    if obj then
                        obj.Value = v
                    end
                end
            end
        end)
    end
end)

---------------- GUI ----------------
print("üé® Creating GUI...")

local gui = Instance.new("ScreenGui")
gui.Name = "LizlukGUI"
gui.ResetOnSpawn = false
gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local guiParent = game:GetService("CoreGui")
local success = pcall(function()
    gui.Parent = guiParent
end)

if not success then
    gui.Parent = player:WaitForChild("PlayerGui")
    warn("‚ö†Ô∏è Using PlayerGui")
else
    print("‚úÖ GUI in CoreGui")
end

---------------- MAIN FRAME (FIXED SCROLLING) ----------------
local main = Instance.new("ScrollingFrame")
main.Name = "Main"
main.Parent = gui
main.Size = UDim2.fromScale(0.36, 0.68)
main.Position = UDim2.fromScale(0.32, 0.16)
main.BackgroundColor3 = Color3.fromRGB(8, 8, 12)
main.BorderSizePixel = 0
main.ScrollBarThickness = 10
main.ScrollBarImageColor3 = Color3.fromRGB(200, 170, 255)
main.Active = true
main.Selectable = true
main.ScrollingEnabled = true
main.ScrollingDirection = Enum.ScrollingDirection.Y
main.CanvasSize = UDim2.new(0, 0, 0, 0)
main.AutomaticCanvasSize = Enum.AutomaticSize.Y

-- Add padding for better layout
local padding = Instance.new("UIPadding")
padding.PaddingTop = UDim.new(0, 10)
padding.PaddingBottom = UDim.new(0, 20)
padding.PaddingLeft = UDim.new(0, 5)
padding.PaddingRight = UDim.new(0, 5)
padding.Parent = main

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 28)
corner.Parent = main

local stroke = Instance.new("UIStroke")
stroke.Color = Color3.fromRGB(200, 170, 255)
stroke.Transparency = 0.35
stroke.Parent = main

-- Add layout for auto-positioning
local layout = Instance.new("UIListLayout")
layout.Parent = main
layout.SortOrder = Enum.SortOrder.LayoutOrder
layout.Padding = UDim.new(0, 8)

---------------- TITLE ----------------
local title = Instance.new("TextLabel")
title.Name = "Title"
title.Parent = main
title.Text = "lizluk üõ°Ô∏è"
title.Font = Enum.Font.GothamBold
title.TextSize = 36
title.TextColor3 = Color3.fromRGB(235, 225, 255)
title.Size = UDim2.new(1, -10, 0, 50)
title.BackgroundTransparency = 1
title.TextScaled = false
title.LayoutOrder = 1

---------------- INPUT FUNCTION ----------------
local currentOrder = 2

local function createInput(labelText, initialValue, callback)
    local box = Instance.new("TextBox")
    box.Parent = main
    box.Text = labelText .. ": " .. tostring(initialValue)
    box.Size = UDim2.new(1, -20, 0, 35)
    box.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
    box.TextColor3 = Color3.new(1, 1, 1)
    box.Font = Enum.Font.Gotham
    box.TextSize = 14
    box.ClearTextOnFocus = true
    box.PlaceholderText = "Enter number..."
    box.LayoutOrder = currentOrder
    currentOrder = currentOrder + 1
    
    local boxCorner = Instance.new("UICorner")
    boxCorner.Parent = box
    
    box.FocusLost:Connect(function(enter)
        if enter then
            local num = tonumber(box.Text)
            if num then
                callback(num)
                box.Text = labelText .. ": " .. tostring(num)
                print("‚úèÔ∏è", labelText, "‚Üí", num)
            else
                box.Text = labelText .. ": " .. tostring(initialValue)
            end
        end
    end)
    
    return box
end

local function createButton(labelText, bgColor, callback)
    local btn = Instance.new("TextButton")
    btn.Parent = main
    btn.Text = labelText
    btn.Size = UDim2.new(1, -20, 0, 35)
    btn.BackgroundColor3 = bgColor
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 14
    btn.LayoutOrder = currentOrder
    currentOrder = currentOrder + 1
    
    local btnCorner = Instance.new("UICorner")
    btnCorner.Parent = btn
    
    btn.MouseButton1Click:Connect(callback)
    
    return btn
end

local function createHeader(text, color)
    local header = Instance.new("TextLabel")
    header.Parent = main
    header.Text = text
    header.Size = UDim2.new(1, -20, 0, 30)
    header.BackgroundColor3 = color
    header.TextColor3 = Color3.new(1, 1, 1)
    header.Font = Enum.Font.GothamBold
    header.TextSize = 16
    header.LayoutOrder = currentOrder
    currentOrder = currentOrder + 1
    
    local headerCorner = Instance.new("UICorner")
    headerCorner.Parent = header
    
    return header
end

---------------- BUILD GUI ----------------

-- Core section
createInput("MaxHealth", DATA.Core.MaxHealth, function(n)
    DATA.Core.MaxHealth = n
    if player.Character then applyCore(player.Character) end
end)

createInput("Health", DATA.Core.Health, function(n)
    DATA.Core.Health = n
    if player.Character then applyCore(player.Character) end
end)

createInput("MaxStamina", DATA.Core.MaxStamina, function(n)
    DATA.Core.MaxStamina = n
    if player.Character then applyCore(player.Character) end
end)

createInput("Stamina", DATA.Core.Stamina, function(n)
    DATA.Core.Stamina = n
    if player.Character then applyCore(player.Character) end
end)

-- Stealth section
createHeader("üõ°Ô∏è ANTI-DETECTION", Color3.fromRGB(85, 35, 55))

-- Create stealth button
local stealthBtn = Instance.new("TextButton")
stealthBtn.Parent = main
stealthBtn.Text = "Stealth: " .. (DATA.Stealth.Enabled and "ON" or "OFF")
stealthBtn.Size = UDim2.new(1, -20, 0, 35)
stealthBtn.BackgroundColor3 = DATA.Stealth.Enabled and Color3.fromRGB(45, 70, 30) or Color3.fromRGB(70, 30, 30)
stealthBtn.TextColor3 = Color3.new(1, 1, 1)
stealthBtn.Font = Enum.Font.Gotham
stealthBtn.TextSize = 14
stealthBtn.LayoutOrder = currentOrder
currentOrder = currentOrder + 1

local stealthCorner = Instance.new("UICorner")
stealthCorner.Parent = stealthBtn

stealthBtn.MouseButton1Click:Connect(function()
    DATA.Stealth.Enabled = not DATA.Stealth.Enabled
    _G.FAKE_STATS.AutoFake = DATA.Stealth.Enabled
    stealthBtn.Text = "Stealth: " .. (DATA.Stealth.Enabled and "ON" or "OFF")
    stealthBtn.BackgroundColor3 = DATA.Stealth.Enabled and Color3.fromRGB(45, 70, 30) or Color3.fromRGB(70, 30, 30)
    print("üõ°Ô∏è Stealth:", DATA.Stealth.Enabled and "ON" or "OFF")
end)

createInput("Fake MaxHP", DATA.Stealth.FakeMaxHealth, function(n)
    DATA.Stealth.FakeMaxHealth = n
    _G.FAKE_STATS.MaxHealth = n
end)

createInput("Fake MaxStam", DATA.Stealth.FakeMaxStamina, function(n)
    DATA.Stealth.FakeMaxStamina = n
    _G.FAKE_STATS.MaxStamina = n
end)

-- Apply button
createButton("Apply Attributes Now", Color3.fromRGB(55, 35, 85), function()
    print("üîÑ Manual apply...")
    applyAttributes()
end)

-- Attributes section
createHeader("üìä ATTRIBUTES", Color3.fromRGB(35, 55, 85))

for k, v in pairs(DATA.AttributesGui) do
    createInput(k, v, function(n)
        DATA.AttributesGui[k] = n
    end)
end

-- Statistics section
createHeader("üìà STATISTICS", Color3.fromRGB(55, 45, 75))

-- Create statistics button
local statsBtn = Instance.new("TextButton")
statsBtn.Parent = main
statsBtn.Text = "Statistics: " .. (DATA.StatisticsGui.Enabled and "ON" or "OFF")
statsBtn.Size = UDim2.new(1, -20, 0, 35)
statsBtn.BackgroundColor3 = DATA.StatisticsGui.Enabled and Color3.fromRGB(45, 70, 30) or Color3.fromRGB(70, 30, 30)
statsBtn.TextColor3 = Color3.new(1, 1, 1)
statsBtn.Font = Enum.Font.Gotham
statsBtn.TextSize = 14
statsBtn.LayoutOrder = currentOrder
currentOrder = currentOrder + 1

local statsCorner = Instance.new("UICorner")
statsCorner.Parent = statsBtn

statsBtn.MouseButton1Click:Connect(function()
    DATA.StatisticsGui.Enabled = not DATA.StatisticsGui.Enabled
    statsBtn.Text = "Statistics: " .. (DATA.StatisticsGui.Enabled and "ON" or "OFF")
    statsBtn.BackgroundColor3 = DATA.StatisticsGui.Enabled and Color3.fromRGB(45, 70, 30) or Color3.fromRGB(70, 30, 30)
    print("üìä Stats:", DATA.StatisticsGui.Enabled and "ON" or "OFF")
end)

createInput("TotalDamageGiven", DATA.StatisticsGui.TotalDamageGiven, function(n)
    DATA.StatisticsGui.TotalDamageGiven = n
end)

createInput("TotalBossDamageGiven", DATA.StatisticsGui.TotalBossDamageGiven, function(n)
    DATA.StatisticsGui.TotalBossDamageGiven = n
end)

---------------- TOGGLE KEY ----------------
UIS.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.Insert then
        gui.Enabled = not gui.Enabled
        print("üëÅÔ∏è GUI:", gui.Enabled and "VISIBLE" or "HIDDEN")
    end
end)

---------------- BUTTERFLIES ----------------
local BUTTERFLY_ID = "rbxassetid://11254757054"
local COUNT = 3
local RADIUS_X, RADIUS_Y = 0.22, 0.28
local SPEED = 0.8

local butterflies = {}
for i = 1, COUNT do
    local img = Instance.new("ImageLabel")
    img.Parent = gui
    img.Image = BUTTERFLY_ID
    img.Size = UDim2.fromScale(0.06, 0.09)
    img.BackgroundTransparency = 1
    img.ZIndex = 999
    
    local glow = Instance.new("UIStroke")
    glow.Color = Color3.fromRGB(210, 170, 255)
    glow.Thickness = 2
    glow.Transparency = 0.35
    glow.Parent = img
    
    table.insert(butterflies, {
        ui = img,
        glow = glow,
        offset = (math.pi * 2 / COUNT) * i
    })
end

local time = 0
RunService.RenderStepped:Connect(function(dt)
    if not gui.Enabled then return end
    time = time + dt * SPEED
    
    local center = main.AbsolutePosition + main.AbsoluteSize / 2
    local viewport = workspace.CurrentCamera.ViewportSize
    
    for _, butterfly in ipairs(butterflies) do
        local angle = time + butterfly.offset
        local x = center.X + math.cos(angle) * (RADIUS_X * viewport.X)
        local y = center.Y + math.sin(angle) * (RADIUS_Y * viewport.Y)
        
        butterfly.ui.Position = UDim2.fromOffset(
            x - butterfly.ui.AbsoluteSize.X / 2,
            y - butterfly.ui.AbsoluteSize.Y / 2
        )
        butterfly.ui.Rotation = math.sin(angle * 2) * 10
        butterfly.glow.Transparency = 0.25 + math.abs(math.sin(angle)) * 0.4
    end
end)

print("‚ú® LIZLUK LOADED ‚ú®")
print("üîê Token: ‚úÖ")
print("üë§ User:", player.Name, "(ID:", player.UserId, ")")
print("üìå Press INSERT to toggle")
print("üõ°Ô∏è Stealth:", DATA.Stealth.Enabled and "ACTIVE" or "OFF")
